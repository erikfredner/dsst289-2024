---
title: "Summarizing and grouping *Star Wars* data"
subtitle: "DSST 289: Introduction to Data Science"
author: "Erik Fredner"
date: "`r Sys.Date()`"
echo: true
format:
  revealjs:
    logo: "images/by-sa.png"
    footer: "https://fredner.org"
    embed-resources: true
    scrollable: true
    code-fold: true
    tables: true
---

# Overview

- Summarizing data with `summarize()`
- Grouping data with `group_by()`
- Handling missing values
- Visualizing summaries with `ggplot2`

# `summarize()`

`summarize()` reduces elements of a data frame with one of several summary
functions. It is a `dplyr` *verb*.

## *Star Wars* data

```{r}
library(tidyverse)
library(ggrepel)
library(knitr)

starwars <- read_csv(file.path("..", "data", "starwars.csv"))

starwars |>
  select(name, height, mass, sex) |>
  slice_head(n = 5) |>
  # pretty-print table for slides:
  kable()
```

## `summarize`-ing height

```{r}
#| code-fold: false
starwars |>
  summarize(mean_height = mean(height, na.rm = TRUE))
```

## Why `na.rm = TRUE`?

The `na.rm` argument is used to remove `NA` values from the calculation.
It would be inaccurate to assume that these should be `0` (or any other value).
If `na.rm = FALSE`, the result will be not available:

```{r}
#| code-fold: false

starwars |> 
  summarize(mean_height = mean(height, na.rm = FALSE))
```

## How to find `na` values?

```{r}
#| code-fold: false
#| code-line-numbers: "3,4"
# Which starwars characters have missing heights?
starwars |>
  # is.na() returns TRUE if the value is NA:
  filter(is.na(height)) |>
  select(name, height) |>
  kable()
```

## `summarize`-ing height and mass

```{r}
#| code-fold: false
starwars |>
  summarize(
    mean_height = mean(height, na.rm = TRUE),
    mean_mass = mean(mass, na.rm = TRUE)
  ) |>
  kable()
```

# `group_by`

- `summarize`-ing single columns is not very interesting.
- `summarize()` gets interesting when we combine it with `group_by()`.

## `height` by `sex`

```{r}
#| code-line-numbers: "2-4"
starwars |>
  group_by(sex) |>
  # summarize within groups:
  summarize(mean_height = mean(height, na.rm = TRUE)) |>
  arrange(mean_height) |>
  kable()
```

## `group_by` multiple variables

```{r}
starwars |>
  group_by(sex, species) |>
  summarize(mean_height = mean(height, na.rm = TRUE)) |>
  arrange(mean_height) |>
  kable()
```

# additional `group` operations

## `n()` gives group sizes

```{r}
starwars |>
  group_by(species) |>
  summarize(n = n()) |>
  arrange(desc(n)) |>
  kable()
```

## `paste()` collapses values in character colums to strings

```{r}
#| code-line-numbers: "3,4"
starwars |>
  group_by(species) |>
  # you can use any string as a separator:
  summarize(names = paste(name, collapse = "ðŸŒµðŸŒµðŸŒµï¸"))
```

# `groupby() |> summarize() |> ggplot()`

## `height` and `mass` grouped by `sex`

```{r}
starwars |>
  filter(!is.na(sex)) |> 
  group_by(sex) |>
  summarize(
    mean_height = mean(height, na.rm = TRUE),
    mean_mass = mean(mass, na.rm = TRUE),
    n = n()
  ) |>
  ggplot(aes(x = mean_height, y = mean_mass, size = n)) +
  geom_point() +
  geom_text_repel(aes(label = sex), size = 5)
```

## Why the outlier(s)?

```{r}
#| code-fold: false
starwars |>
  filter(sex == "hermaphroditic") |>
  select(name, height, mass, sex) |>
  kable()
```

## Notes of caution for summarizing groups

- Make sure that the groups are comparable
- Be aware of missing data
- Be aware of outliers
- Be aware of the number of items in each group

# Summary

- Use `summarize()` to compute summary statistics.
- Combine `summarize()` with `group_by()` to perform group-wise summaries.
- Beware missing data! `na`, `None`, etc.
  - Handle missing data with `na.rm = TRUE`.
- Visualize group summaries with `ggplot2`.
